{% extends 'site/base.html.twig' %}

{% block title %}Article {{ slug|capitalize }} {% endblock %}

{% block main %}

<div class="container">
    <section class="section-1-articles">
        <div class="row">
            <div class="col-md-12">
                <h1 class="titre-section">{{ titre_1 }}</h1>
                <p class="paragraph-section">{{ paragraph_1|striptags|raw }}</p>
                <div class="temps-lecture">
                    <p>Lecture : {{ temps_lecture }} minutes</p>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <img src="{{ asset('uploads/images/' ~ image) }}" alt="{{ slug|capitalize }}" class="img-fluid image-article">
            </div>
        </div>
    </section>

    <section class="section-2-articles">
        <div class="row">
            <div class="col-md-12">
                <h2 class="titre-section">{{ titre_2 }}</h2>
                <p class="paragraph-section">{{ paragraph_2|striptags|raw }}</p>
            </div>
        </div>
    </section>

    <section class="section-3-articles">
        <div class="row">
            <div class="col-md-12">
                <h3 class="titre-section">{{ titre_3 }}</h3>
                <p class="paragraph-section">{{ paragraph_3|striptags|raw }}</p>
            </div>
        </div>
    </section>
</div>

<section class="section-4-articles">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
            {% set libelles = [
                'Prix',
                'Sécurité',
                'Hébergement',
                'Activités',
                'Gastronomie',
                'Transports',
                'Ecologie',
                'Accessibilité pour personne à mobilité réduite',
                'Activités pour les enfants',
                'Activités sportives',
                'Culture',
                'Bien-être'
            ] %}
                <table class="table">
                    <thead>
                        <tr>
                            <th></th>
                            {% for villeRandoms in villesRandom %}
                                <th>
                                    {{ villeRandoms.getNom() }}
                                </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in 1..12 %}
                            {% set functionName = 'isTabLibelle' ~ i %}
                            {% if attribute(article, functionName) %}
                                <tr class="{% if loop.index is even %}ligne-paire{% else %}ligne-impaire{% endif %}">
                                    <td>{{ libelles[i - 1] }}</td>
                                    {% for villeRandom in villesRandom %}
                                        <td>{{ attribute(villeRandom, 'getNoteTabItem' ~ i) }}/10</td>
                                    {% endfor %}
                                </tr>
                            {% endif %}
                        {% endfor %}
                       <tr class="ligne-paire">
                        <td></td>

                        {% if villesRandom|length > 0 %}
                            {% for i in range(1, 3) %}
                                <td>
                                <a class="btn bouton_tab">
                                Voir les prix
                                </a>
                                </td>
                            {% endfor %}
                        {% endif %}
                    </tr>
                    </tbody>

                </table>
            </div>
        </div>
    </div>
</section>

<section class="section-5-articles">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h4 class="titre-section">{{ titre_4 }}</h4>
                <p class="paragraph-section">{{ paragraph_4|striptags|raw }}</p>
            </div>
        </div>
    </div>
</section>

<section class="section-6-articles">
    <div class="container">
        <div class="row">
         <div class="col-12">
            <h2 class="titre-section titre-section2 sujets">Sujets liés</h2>
        </div>
            {% for i in range(1, 3) %}
                <div class="col-12 col-md-4">
                    <div class="card">
                        <img src="chemin/vers/image{{ i }}.jpg" class="card-img-top" alt="Image {{ i }}">
                        <div class="card-body">
                            <h5 class="card-title">Titre de l'article {{ i }}</h5>
                            <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</section>

<section class="container section-7-articles">
    <div class="row" id="nouveaux-articles-container">
        <div class="col-12">
            <h2 class="titre-dernier-articles"><strong>Derniers articles</strong></h2>
        </div>
        {% for article in lastArticles %}
        <div class="col-12">
            <a href="{{ path('article_show', {'slug': article.getSlug()}) }}" class="card card3">
                <div class="row">
                    <div class="col-md-4">
                        <img src="{{ asset('uploads/images/' ~ article.getImage1()) }}" class="card-img fixed-image" alt="Image">
                    </div>
                    <div class="col-md-8 container-title-section7">
                        <h3 class="titre-voyage titre-sec7">Voyage à {{ article.getSousCategories2() }}</h3>
                        <h4 class="titre-article titre-sec7">{{ article.getTitre1() }}</h4>
                        <p class="date-article titre-sec7">{{ article.getCreatedDate()|date('d/m/Y') }}</p>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>

{% if total > 0 %}
    <div class="col-12">
        <a class="btn bouton1 bouton2" id="charger-plus" data-offset="{{ offset }}" data-total="{{ total }}">
            Découvrir plus
        </a>
    </div>
{% endif %}
</section>

<script>
$(document).ready(function () {
    $(document).on('click', '#charger-plus', function () {
        var offset = $(this).data('offset');
        var total = $(this).data('total');
        $.ajax({
            url: "{{ path('load_more_articles', {'offset': 0}) }}".replace('0', offset),
            type: "GET",
            data: {
                offset: offset
            },
            success: function (response) {
                $('#nouveaux-articles-container').append(response);
                if (offset + 3 >= total) {
                    $('#charger-plus').remove();
                } else {
                    $('#charger-plus').data('offset', offset + 3);
                }
            }
        });
    });
});

</script>

{% endblock %}
